<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>æœƒè­°å®¤é ç´„ç³»çµ±</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        .success { background: #d4edda; padding: 10px; }
        .error { background: #f8d7da; padding: 10px; color: #721c24; }
    </style>
</head>
<body>
    <h1>æœƒè­°å®¤é ç´„</h1>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="{{ category }}">{{ message }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <form action="/book" method="POST">
        æœƒè­°å®¤ï¼š<select name="room">
            <option>Ræ¨“</option>
            <option>è£•æ—</option>
        </select><br>
        æ—¥æœŸï¼š<input type="date" name="date" required><br>
        èµ·å§‹æ™‚é–“ï¼š<select name="start_time">
            {% for h in range(0,24) %}
              <option>{{ '%02d' % h }}:30</option>
              <option>{{ '%02d' % h }}:00</option>
            {% endfor %}
        </select><br>
        çµæŸæ™‚é–“ï¼š<select name="end_time">
            {% for h in range(0,24) %}
              <option>{{ '%02d' % h }}:30</option>
              <option>{{ '%02d' % h }}:00</option>
            {% endfor %}
        </select><br>
        é ç´„äººï¼š<input type="text" name="user" required><br>
        å–æ¶ˆå¯†ç¢¼ï¼š<input type="password" name="cancel_code" required><br>
        é‡è¤‡é€±æ•¸ï¼ˆå¯ä¸å¡«ï¼‰ï¼š<input type="number" name="repeat_weeks"><br>
        <button type="submit">é ç´„</button>
    </form>

    <h3>ç›®å‰é ç´„ï¼š</h3>
    <ul>
    {% for b in bookings %}
        <li>{{ b[1] }}ï½œ{{ b[2] }} {{ b[3] }}~{{ b[4] }}ï½œ{{ b[5] }}
            {% if admin %}
              <a href="/cancel/{{ b[0] }}">âŒ ç®¡ç†å–æ¶ˆ</a>
            {% else %}
              <a href="/cancel/{{ b[0] }}">å–æ¶ˆ</a>
            {% endif %}
        </li>
    {% endfor %}
    </ul>

    <h3>æ­·å²é ç´„ï¼š</h3>
    <ul>
    {% for b in history %}
        <li>{{ b[1] }}ï½œ{{ b[2] }} {{ b[3] }}~{{ b[4] }}ï½œ{{ b[5] }}</li>
    {% endfor %}
    </ul>

    <hr>
    {% if admin %}
        <a href="/backup_db">ğŸ“¥ å‚™ä»½è³‡æ–™åº«</a><br>
        <a href="/restore_db">ğŸ“¤ é‚„åŸè³‡æ–™åº«</a><br>
        <a href="/admin/logout">ğŸšª ç®¡ç†å“¡ç™»å‡º</a>
    {% else %}
        <a href="/admin/login">ğŸ” ç®¡ç†å“¡ç™»å…¥</a>
    {% endif %}
</body>
</html>
